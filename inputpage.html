<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/styles/privateStyle.css" />
    <link rel="stylesheet" href="/styles/style.css" />
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <script type="module">
      import { getMember, updateMember } from "./js/member.js";

      // init
      const inputBoxList = $(".inputBox");
      const compBtn = $("#completeModify");

      let isModify = false;
      let info = {
        id: null,
        data: null,
      };

      let updateData = {};

      const qs = new URLSearchParams(location.search);
      const name = qs.get("name");
      const isModifyMode = name !== null ? true : false;

      (async () => {
        if (isModifyMode) {
          info = await getMember("name", name);
          if (info.data === null) {
            // alert("데이터가 존재하지 않습니다.")
            return;
          }
          const keys = Object.keys(info.data);
          keys.forEach((key) => {
            document.getElementById(key).value = info.data[key];
          });
          $("#name").attr("readonly", true);
          return;
        }
      })();

      // end init

      const updateInfo = async () => {
        if (updateData.name === undefined) return;
        await updateMember(info.id ?? null, updateData);
      };
      compBtn.click(updateInfo);

      const onBlurInput = (e) => {
        if (e.target.value.trim() === "") return;
        updateData[e.target.id] = e.target.value;
      };
      inputBoxList.blur(onBlurInput);
    </script>
  </head>
  <body>
    <header id="header">
      <div id="logoWrapper">
        <a href="/" id="logo">4Dev Project</a>
      </div>
    </header>
    <container>
      <div id="aboutWrapper">
        <div id="aboutBox">
          <div id="leftBox">
            <input
              id="name"
              value=""
              style="font-size: 24px"
              class="inputBox"
              placeholder="이름"
            />
            <input
              id="mbti"
              value=""
              placeholder="MBTI"
              style="font-size: 24px"
              class="inputBox"
            />
          </div>
        </div>
      </div>
      <div id="contBtnWrapper">
        <button id="completeModify">완료</button>
      </div>
    </container>
  </body>
</html>
